version: "1"
services:
  web:
    command: "/usr/local/bin/web"
    user: "www-data"
    group: "www-data"
    supplementary_groups: ["www-logs"]
    restart_policy: "always"
    limits:
      nofile: 65536
      nproc: 4096
      memlock: "unlimited"
      nice: -5
      cpu_affinity: [0,1]
      cgroup:
        memory_max: "512M"
        cpu_max: "200000 100000"
    capabilities:
      - CAP_NET_BIND_SERVICE
      - CAP_SYS_NICE
    isolation:
      network: true
      pid: true
      mount: true
      private_tmp: true

  worker:
    command: "/usr/local/bin/worker"
    user: "app"
    group: "app"
    restart_policy: "on-failure"
    limits:
      nofile: 32768
      nice: 5

cron:
  nightly_backup:
    command: "/usr/local/bin/backup"
    cron:
      expression: "0 0 * * * *"
